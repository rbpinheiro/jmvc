/* JMVC (https://github.com/rbpinheiro/jmvc) */
var jmvc={};(function(e){"use strict";jmvc._config={controllers_folder:"js/controller/",views_folder:"js/view/",models_folder:"js/model/",default_element:"body",default_id_key:"id"},jmvc._events={},jmvc._controllers={},jmvc._models={},jmvc._libraries={},jmvc._modelID=0,jmvc.controllers={get:function(e){return jmvc._controllers[e]}},jmvc.models={load:function(t,n){t in jmvc._models?n.call(jmvc._controller,new jmvc._models[t]):e.ajax({url:jmvc._config.models_folder+t+".js",dataType:"script",success:function(){n.call(jmvc._controller,new jmvc._models[t])},error:function(e,t){console.log(t)}})}},jmvc.config=function(t){jmvc._config=e.extend(jmvc._config,t)},jmvc.registerLibrary=function(e,t){jmvc._libraries[e]={path:t,loaded:!1}},jmvc._throwError=function(e){throw"JMVCError: "+e}})(jQuery),jmvc.Router=function(){function e(){c=window.location.hash.replace(/^#!/,"")}function t(e,t){if(void 0!==jmvc._controller&&(jmvc._controller.unbindEvents(),void 0!==jmvc._controller.unload&&jmvc._controller.unload()),jmvc._controller=jmvc._controllers[e],void 0===jmvc._controller&&jmvc._throwError('Controller "'+e+'" not found'),t===!0){var n,o;o=function(e){n=jmvc._controller.dependencies[e],void 0!==n?jmvc._libraries[n].loaded===!1&&$.ajax({url:jmvc._libraries[n].path,dataType:"script",success:function(){o(e+1)},error:function(){}}):(jmvc._controller.init(),jmvc._controller.load())},o(0)}else jmvc._controller.load()}function n(e){e=jmvc._routes[e]?e:"404";var n=jmvc._routes[e].replace(/\//g,".");n in jmvc._controllers?t(n):$.ajax({url:jmvc._config.controllers_folder+jmvc._routes[e]+".js",dataType:"script",success:function(){t(n,!0)},error:function(e,t,n){console.log(n)}})}function o(t,o){void 0!==o?(jmvc._config=t,jmvc._routes=$.extend(jmvc._routes,o)):jmvc._routes=$.extend(jmvc._routes,t),e(),n(c)}jmvc._routes={404:"404"};var c="";return $(window).bind("hashchange",function(){e(),n(c)}),o}(),jmvc.Controller=function(){function e(e){var t=e.split(" ",1)[0];return[t,e.replace(RegExp("^"+t+" "),"")]}function t(t,n){jmvc._controllers[t]=$.extend({element:$(jmvc._config.default_element),events:{},dependencies:[],init:function(){},load:function(){},unload:function(){},bindEvents:function(){for(var e in this.events)this.bind(e,this.events[e])},unbindEvents:function(){var e;for(var t in this.events)e=t.split(" "),this.element.find(e[1]).unbind(e[0])},render:function(e,t,n){if(void 0===n)var n=t,t=e,e=this.element;var o=new EJS({url:jmvc._config.views_folder+t+".ejs"}).render(n);this.element.html(o),this.bindEvents()},$:function(e){return this.element.find(e)},bind:function(t,n){var o=e(t),c=this;this.events[t]=n,this.$(o[1]).bind(o[0],function(e){c[n].call(c,e)})}},n)}return t}(),jmvc.Model=function(e,t){jmvc._models[e]=function(){this._eventNamespace="model."+e+jmvc._modelID,jmvc._modelID+=1,this.init()},jmvc._models[e].prototype=$.extend({url:"",events:{},values:{},id_key:jmvc._config.default_id_key,init:function(){},set:function(e,t){if("object"==typeof e)for(var n in e)this.set(n,e[n]);if("string"==typeof e&&void 0===t)for(var o=e.split("&"),c=0;o.length>c;c++)t=o[c].split("="),void 0!==t[1]&&this.set(t[0],t[1]);else this.values[e]=t,jmvc.eventBus.publish(this._eventNamespace,"change",[e],this),jmvc.eventBus.publish(this._eventNamespace,"change:"+e,[e],this)},get:function(e){return this.values[e]},toJson:function(){return this.values},bind:function(e,t){jmvc.eventBus.subscribe(this._eventNamespace,e,t)},save:function(e,t){var n=this,o="POST",c=this.url;this.get(this.id_key)&&(o="PUT",c+="/"+this.get(this.id_key)),$.ajax({type:o,url:c,data:this.toJson(),success:function(t,o){n.set(t),e&&e.call(n,t,o)},error:function(e,o,c){t&&t.call(n,o,c)}})},fetch:function(e,t,n){var o=this.url;("string"==typeof e||"number"==typeof e)&&(o=o+"/"+e),$.ajax({type:"GET",url:o,data:e,success:function(e,n){this.set(e),t&&t.call(self,e,n)},error:function(e,t,o){n&&n.call(self,t,o)}})},"delete":function(e,t){var n=this.url+"/"+this.get(this.id_key);$.ajax({type:"DELETE",url:n,data:this.toJson(),success:function(t,n){this.set(t),e&&e.call(self,t,n)},error:function(e,n,o){t&&t.call(self,n,o)}})}},t)},jmvc.ModelCollection=function(){},jmvc.ModelCollection.prototype={url:"",events:{},modelObjects:{},set:function(e,t){for(var n in this.modelObjects)n.set(e,t)},get:function(e){var t=[];for(var n in this.modelObjects)t.push(n.get(e));return t},toJson:function(){var e=[];for(var t in this.modelObjects)e.push(t.toJson());return e},bind:function(e,t){for(var n in this.modelObjects)values.bind(e,t)},save:function(){},fetch:function(e,t,n){var o=this.url;$.ajax({type:"GET",url:o,data:e,success:function(e,n){t&&t.call(self,e,n)},error:function(e,t,o){n&&n.call(self,t,o)}})},"delete":function(e,t){var n=this.url+"/"+this.get(this.id_key);$.ajax({type:"DELETE",url:n,data:this.toJson(),success:function(t,n){this.set(t),e&&e.call(self,t,n)},error:function(e,n,o){t&&t.call(self,n,o)}})}},jmvc.eventBus={subscribe:function(e,t,n){e in jmvc._events||(jmvc._events[e]={}),t in jmvc._events[e]||(jmvc._events[e][t]=[]),jmvc._events[e][t].push(n)},publish:function(e,t,n,o){if(jmvc._events[e]&&jmvc._events[e][t])for(var t=jmvc._events[e][t],c=0;t.length>c;c++)t[c].apply(o,n)}};